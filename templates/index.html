<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fact & Image Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans text-center">

    <h2 class="text-4xl font-bold mt-10 text-teal-400 animate-fadeIn">üîç AI Fact & Image Checker</h2>

    <div id="container" class="flex flex-col md:flex-row justify-center items-start mt-10 space-y-6 md:space-y-0 md:space-x-10 px-5">
        
        <!-- Fact Checking Section -->
        <div class="bg-gray-800 bg-opacity-80 backdrop-blur-md shadow-lg p-6 rounded-xl w-full md:w-1/3 transition transform hover:scale-105">
            <h3 class="text-xl font-semibold text-teal-300">üìú Fact Checking</h3>
            <input type="text" id="claim" placeholder="Enter a fact to verify..." 
                class="w-full mt-3 p-3 bg-gray-700 text-white border border-teal-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-400">
            <button onclick="checkFact()" class="w-full mt-3 bg-teal-400 text-gray-900 font-bold py-2 rounded-lg transition transform hover:scale-105">
                Check Fact
            </button>
            <p id="factResult" class="mt-4 text-lg"></p>
        </div>

        <!-- Image Checking Section -->
        <div class="bg-gray-800 bg-opacity-80 backdrop-blur-md shadow-lg p-6 rounded-xl w-full md:w-1/3 transition transform hover:scale-105">
            <h3 class="text-xl font-semibold text-teal-300">üñºÔ∏è Image Fake Detection</h3>

            <!-- Drag & Drop File Upload -->
            <div class="border-dashed border-2 border-teal-300 p-6 mt-3 rounded-lg cursor-pointer hover:bg-gray-700" onclick="document.getElementById('imageUpload').click()">
                <p class="text-teal-400">üìÇ Drag & Drop or Click to Upload</p>
                <input type="file" id="imageUpload" onchange="previewImage()" class="hidden">
            </div>

            <img id="imagePreview" class="mt-3 w-full rounded-lg hidden shadow-md" />
            <button onclick="checkImage()" class="w-full mt-3 bg-teal-400 text-gray-900 font-bold py-2 rounded-lg transition transform hover:scale-105">
                Analyze Image
            </button>
            <p id="imageResult" class="mt-4 text-lg"></p>
            <div id="confidenceBarContainer" class="hidden mt-3 w-full bg-gray-700 rounded-full h-4">
                <div id="confidenceBar" class="bg-teal-400 h-4 rounded-full text-xs text-center text-gray-900 font-bold"></div>
            </div>
        </div>
    </div>

    <!-- History Section -->
    <div class="bg-gray-800 bg-opacity-80 backdrop-blur-md shadow-lg p-6 rounded-lg w-11/12 md:w-2/3 mx-auto mt-10">
        <h3 class="text-xl font-semibold text-teal-300">üìÇ Analysis History</h3>
        <div id="historyList" class="mt-3 space-y-2"></div>
        <button class="mt-3 bg-red-500 text-white font-bold py-2 px-4 rounded-lg transition transform hover:scale-105"
            onclick="clearHistory()">
            Clear History
        </button>
    </div>

    <script>
        function updateHistory(entry) {
            let history = JSON.parse(localStorage.getItem("history")) || [];
            history.unshift(entry);
            localStorage.setItem("history", JSON.stringify(history));
            displayHistory();
        }

        function displayHistory() {
            let historyList = document.getElementById("historyList");
            if (!historyList) return;
            historyList.innerHTML = "";
            let history = JSON.parse(localStorage.getItem("history")) || [];

            history.forEach(item => {
                let div = document.createElement("div");
                div.classList.add("bg-gray-700", "p-3", "rounded-lg", "text-white", "shadow-md", "animate-fadeIn");
                div.innerHTML = `<strong>${item.type}:</strong> ${item.result} (Confidence: ${item.confidence}%)`;
                historyList.appendChild(div);
            });
        }

        function clearHistory() {
            localStorage.removeItem("history");
            displayHistory();
        }

        function previewImage() {
            const file = document.getElementById("imageUpload").files[0];
            const preview = document.getElementById("imagePreview");
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove("hidden");
                }
                reader.readAsDataURL(file);
            }
        }

        async function checkFact() {
            const claim = document.getElementById("claim").value;
            if (!claim) { alert("Enter a fact to check!"); return; }

            document.getElementById("factResult").innerHTML = "üîç Checking...";
            const response = await fetch(`http://127.0.0.1:5000/check_fact?claim=${encodeURIComponent(claim)}`);
            const data = await response.json();

            document.getElementById("factResult").innerHTML = `<strong>Result:</strong> ${data.analysis}`;
            updateHistory({ type: "Fact", result: data.analysis, confidence: "N/A" });
        }

        async function checkImage() {
            const imageFile = document.getElementById("imageUpload").files[0];
            if (!imageFile) { alert("Upload an image!"); return; }

            let formData = new FormData();
            formData.append("file", imageFile);

            document.getElementById("imageResult").innerHTML = "üïµÔ∏è‚Äç‚ôÇÔ∏è Analyzing...";
            const response = await fetch("http://127.0.0.1:5001/analyze-image", { method: "POST", body: formData });
            const data = await response.json();

            document.getElementById("imageResult").innerHTML = `<strong>Result:</strong> ${data.result} <br> Confidence: ${data.confidence}%`;
            
            let confidenceBar = document.getElementById("confidenceBar");
            let confidenceBarContainer = document.getElementById("confidenceBarContainer");
            confidenceBar.style.width = `${data.confidence}%`;
            confidenceBar.innerText = `${data.confidence}%`;
            confidenceBarContainer.classList.remove("hidden");

            updateHistory({ type: "Image", result: data.result, confidence: data.confidence });
        }

        displayHistory();
    </script>

</body>
</html>
